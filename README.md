[![Build Status](https://travis-ci.org/QubesOS/qubesos.github.io.svg?branch=master)](https://travis-ci.org/QubesOS/qubesos.github.io)

Qubes OS Official Website
=========================

Canonical URL: https://www.qubes-os.org

This is the main repository for the [Qubes OS Project](https://github.com/QubesOS) website. Qubes is
a security-oriented, open-source operating system for personal computers. It
uses virtualization to implement [security by compartmentalization](https://www.qubes-os.org/intro/) and
supports both Linux and Windows virtual environments.


Your support counts!
--------------------

Qubes OS is free and open-source software. If you rely on Qubes for secure
computing in your work or personal life, or see the value in our efforts, please
consider making a [donation](https://www.qubes-os.org/donate/) today.

<a href="https://opencollective.com/qubes-os/backer/0/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/0/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/1/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/1/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/2/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/2/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/3/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/3/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/4/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/4/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/5/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/5/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/6/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/6/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/7/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/7/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/8/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/8/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/9/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/9/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/10/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/10/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/11/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/11/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/12/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/12/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/13/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/13/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/14/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/14/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/15/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/15/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/16/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/16/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/17/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/17/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/18/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/18/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/19/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/19/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/20/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/20/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/21/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/21/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/22/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/22/avatar.svg"></a>
<a href="https://opencollective.com/qubes-os/backer/23/website" target="_blank"><img src="https://opencollective.com/qubes-os/backer/23/avatar.svg"></a>

--------------------------------------------------------------------------------

Contents
--------

This repository consists of a [Jekyll](https://jekyllrb.com/) site and several Git submodules for
content:

 - `qubes-doc` (official documentation)
 - `qubes-attachment` (binary files such as images)
 - `qubes-hcl` (Hardware Compatibility List (HCL) reports generated by a YAML
   version of `qubes-hcl-report`)
 - `qubes-posts` (news and blog posts)

Instructions
------------

### Podman Compose ###

1. Install `podman` and `podman-compose`.

2. Start the Podman daemon, e.g.:

        $ sudo systemctl start podman

3. Clone this repo, including all submodules, and enter it:

        $ git clone --recursive https://github.com/QubesOS/qubesos.github.io.git
        $ cd qubesos.github.io/

4. Start and run the website:

        $ sudo make

5. Open your browser and navigate to:

        http://127.0.0.1:4000/

### Notes ###

 - To update the submodules, use `git submodule foreach git pull --tags`.
 - For troubleshooting with RubyGems, see: <http://guides.rubygems.org/>
 - For troubleshooting with Jekyll, see: <https://jekyllrb.com/docs/home/>
 - For troubleshooting with GitHub pages and Jekyll, see: <https://help.github.com/articles/using-jekyll-as-a-static-site-generator-with-github-pages/>
 - To run on a Git post-receive hook, use:

        GIT_REPO=/usr/home/git/repositories/www.qubes-os.org.git
        GIT_CLONE=/usr/home/git/tmp/www.qubes-os.org
        PUBLIC_WWW=/usr/local/www/qubes-os.org/www/

        if [ ! -d "$GIT_CLONE" ]; then
            git clone --recursive $GIT_REPO $GIT_CLONE
        else
            git --work-tree=$GIT_CLONE --git-dir=$GIT_CLONE/.git pull
        fi
        cd $GIT_CLONE && jekyll build -s $GIT_CLONE -d $PUBLIC_WWW

        find $PUBLIC_WWW -type f -print0 | xargs -0 chmod 666
        find $PUBLIC_WWW -type d -print0 | xargs -0 chmod 777

        exit

Documentation Guidelines
------------------------

Our [Documentation Guidelines](https://www.qubes-os.org/doc/doc-guidelines/) include:
 - How to Report Issues
 - How to Contribute
 - Contribution Suggestions
 - Style Guidelines
 - Markdown Conventions
 - Git Conventions

Please carefully read these guidelines before submitting a pull request.

### Dependencies & Third Party Docs ###

 - [Jekyll Documentation](http://jekyllrb.com/docs/) - template rendering engine
 - [Bootstrap 3](http://getbootstrap.com) - styling and CSS structure
 - [FontAwesome](http://fontawesome.io) - the icon font throughout the site
 - [jQuery 1.7](http://api.jquery.com) - javascript helper library
 - [jQuery ToC MD Generator](https://github.com/dafi/tocmd-generator) - renders header menu on documentation section

Translation
------------

Documentation translation is done using Transifex platform: https://www.transifex.com/otf/qubes/
The `_translated` directory should not be modified manually. Any manual change
there **will be overriden** with the content downloaded from Transifex.

The `qubes-translated` repository is not signed and generally should not be
considered trusted for sensitive tasks. But the specific commit referenced from
this repository is validated to not interfere with English website.

### Transifex integration details ###

Most of the integration is automated. It is split into few parts:

1. `_utils/transifex-push` script takes the source (English) content and
   uploads to Transifex. The platform merges existing translations to the new
   files, so unchanged parts that were translated before remain translated.
   Transifex configuration is created from scratch here, to correctly handle
   new/removed files.

2. `_utils/transifex-pull` pulls translated content and places into
   `_translated` submodule. Then a set of scripts in
   `_utils/_translation_utils` perform various post processing steps,
   including:
   - validate syntax of retrieved files (if frontmatter is still correctly set etc)
   - modify frontmatter settings (`permalink`, `lang`, `redirect_from` etc) to
     match the page language
   - adjust all internal links to point at pages in the same language
   - run htmlproofer to verify if no broken links were introduced

   At the end, the script commit and push the new content to qubes-translated
   repository.

3. `_utils/update-translated` fetches new version of qubes-translated repo (its
   master branch), verifies if any page doesn't try to subvert English version,
   and if all is fine, makes a commit and push updated submodule (similar to
   `_utils/update-submodules` script).

The points 1 and 2 are running in Gitlab CI environment, without access to any
signing key and with push access only to qubes-translated repository. The third
point is running in a more trusted environment, with access to signing key and
push access to the main repository.

### Language switcher ###

The top level `_config.yml` file contains list of languages to be enabled. If
there is more than one (`en`), each page will have a language switch menu in
the top right corner. Only languages listed in `_config.yml` are visible in the
switcher, but there may be more available (accessing them require manually
changing language code in the URL).

Each markdown file in the repo has `lang` and `ref` attributes (in its
frontmatter). `lang` attribute contains the language of this file
(should always be `en` outside of qubes-translated repository) and `ref`
contains a unique identifier of that page. Language switcher logic uses the
`ref` attribute to find all translations of given page. This allows translated
page to have different page name in URL, although we do not do this right now.

`lang` and `ref` attributes are added with
`_utils/_translation_utils/prepare_for_translation.py` script.

Deprecated Documentation
------------------------

 - [qubes-os.org-3.2-EOL.zip](https://github.com/QubesOS/qubesos.github.io/releases/download/3.2-EOL/qubes-os.org-3.2-EOL.zip) contains the state of the Qubes website when
   [Qubes OS 3.2 reached EOL](https://www.qubes-os.org/news/2019/03/28/qubes-3-2-has-reached-eol/). All you need to browse it is a web browser.
 - Here is the state of this repo and all submodules when [Qubes OS 3.2 reached
   EOL](https://www.qubes-os.org/news/2019/03/28/qubes-3-2-has-reached-eol/):
   - https://github.com/QubesOS/qubesos.github.io/tree/3.2-EOL
   - https://github.com/QubesOS/qubes-doc/tree/3.2-EOL
   - https://github.com/QubesOS/qubes-hcl/tree/3.2-EOL
   - https://github.com/QubesOS/qubes-posts/tree/3.2-EOL
   - https://github.com/QubesOS/qubes-attachment/tree/3.2-EOL

